<div class="admin-orders-container">
  <h2>Order Management</h2>

  <!-- <div *ngIf="isLoading" class="loading-spinner">
    <p>Loading orders...</p>
  </div> -->
  

  <div>
    <div  *ngIf="isLoading" class="loader-5">
      <svg
        viewBox="0 0 187.3 93.7"
        height="200px"
        width="300px"
        class="svgbox"
      >
        <defs>
          <linearGradient y2="0%" x2="100%" y1="0%" x1="0%" id="gradient">
            <stop stop-color="#8f44fd" offset="0%"></stop>

            <stop stop-color="#fd44db" offset="100%"></stop>
          </linearGradient>
        </defs>

        <path
          stroke="url(#gradient)"
          d="M93.9,46.4c9.3,9.5,13.8,17.9,23.5,17.9s17.5-7.8,17.5-17.5s-7.8-17.6-17.5-17.5c-9.7,0.1-13.3,7.2-22.1,17.1c-8.9,8.8-15.7,17.9-25.4,17.9s-17.5-7.8-17.5-17.5s7.8-17.5,17.5-17.5S86.2,38.6,93.9,46.4z"
        ></path>
      </svg>
    </div>
    <p>Loading orders...</p>
  </div>


  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadAllOrders()" class="retry-btn">Retry</button>
  </div>

  <div *ngIf="!isLoading && !error && orders.length === 0" class="no-orders">
    <p>No orders found.</p>
  </div>

  <div *ngIf="!isLoading && !error && orders.length > 0" class="orders-table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>User Email</th>
          <th>Status</th>
          <th>Created Date</th>
          <th>Payment Amount</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders" class="order-row">
          <td>{{ order.id }}</td>
          <td>{{ order.email }}</td>
          <td>
            <span [class]="getStatusClass(order.status)">{{ getStatusText(order.status) }}</span>
          </td>
          <td>{{ order.createdDate | date:'medium' }}</td>
          <td>${{ order.paymentAmount }}</td>
          <td>
            <button (click)="openStatusModal(order)" class="update-status-btn">Update Status</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Status Update Modal -->
<div *ngIf="showStatusModal && selectedOrder" class="modal-overlay" (click)="closeStatusModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Update Order Status</h3>
      <button (click)="closeStatusModal()" class="close-btn">&times;</button>
    </div>

    <div class="modal-body">
      <p><strong>Order ID:</strong> {{ selectedOrder.id }}</p>
      <p><strong>User:</strong> {{ selectedOrder.email }}</p>
      <p><strong>Current Status:</strong> {{ getStatusText(selectedOrder.status) }}</p>

      <div class="status-selection">
        <label for="status-select">New Status:</label>
        <select id="status-select" [(ngModel)]="selectedOrder.status" class="status-select">
          <option *ngFor="let status of orderStatuses" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <button (click)="closeStatusModal()" class="cancel-btn">Cancel</button>
      <button (click)="updateOrderStatus(selectedOrder.id, selectedOrder.status)" class="update-btn" [disabled]="isLoading">
        {{ isLoading ? 'Updating...' : 'Update Status' }}
      </button>
    </div>
  </div>
</div>
