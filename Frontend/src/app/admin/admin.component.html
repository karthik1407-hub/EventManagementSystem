<div class="admin-container">
  <h1>Admin Dashboard</h1>
  <div class="admin-sections">
    <!-- Users Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('users')" [class.expanded]="expandedSections().has('users')">
        <h2>Users ({{ countSignals.get('users')!() }})</h2>
        <span class="toggle-icon">{{ expandedSections().has('users') ? '▼' : '▶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('users')">
        <button class="add-btn" (click)="addEntity('users')">Add User</button>
        <ul class="data-list">
          <li *ngFor="let user of dataSignals.get('users')!()" class="data-item">
            <div class="item-info">
              {{ user.name }} - {{ user.email }}
            </div>
            <div class="item-actions">
        <button class="edit-btn" (click)="editEntity('users', user)">Edit</button>
        <button class="delete-btn" (click)="initiateDelete('user', user.userID.toString())">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Feedback Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('feedback')" [class.expanded]="expandedSections().has('feedback')">
        <h2>Feedback ({{ countSignals.get('feedback')!() }})</h2>
        <span class="toggle-icon">{{ expandedSections().has('feedback') ? '▼' : '▶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('feedback')">
        <button class="add-btn" (click)="addEntity('feedback')">View Feedbacks</button>
        <ul class="data-list">
          <li *ngFor="let item of dataSignals.get('feedback')!()" class="data-item">
            <div class="item-info">
              <strong>User:</strong> {{ getUserName(item.userID) }} | <strong>Event:</strong> {{ getEventName(item.eventID) }}<br>
              <strong>Rating:</strong> {{ item.rating }}/5 | <strong>Comments:</strong> {{ item.comments }}
            </div>
            <div class="item-actions">
              
              <button class="delete-btn" (click)="initiateDelete('feedback', item.feedbackID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Notifications Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('notifications')" [class.expanded]="expandedSections().has('notifications')">
        <h2>Notifications ({{ countSignals.get('notifications')!() }})</h2>
        <span class="toggle-icon">{{ expandedSections().has('notifications') ? '▼' : '▶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('notifications')">
        <button class="add-btn" (click)="addEntity('notifications')">Add Notification</button>
        <ul class="data-list">
          <li *ngFor="let item of dataSignals.get('notifications')!()" class="data-item">
            <div class="item-info">
              {{ item.message }} - {{ item.sentTimestamp | date:'medium' }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editEntity('notifications', item)">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('notification', item.notificationID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Tickets Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('tickets')" [class.expanded]="expandedSections().has('tickets')">
        <h2>Tickets ({{ countSignals.get('tickets')!() }})</h2>
        <span class="toggle-icon">{{ expandedSections().has('tickets') ? '▼' : '▶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('tickets')">
        <button class="add-btn" (click)="addEntity('tickets')">Add Ticket</button>
        <ul class="data-list">
          <li *ngFor="let item of dataSignals.get('tickets')!()" class="data-item">
            <div class="item-info">
              {{ item.eventID }} - {{ item.ticketID }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editEntity('tickets', item)">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('ticket', item.ticketID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Events Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('events')" [class.expanded]="expandedSections().has('events')">
        <h2>Events ({{ countSignals.get('events')!() }})</h2>
        <span class="toggle-icon">{{ expandedSections().has('events') ? '▼' : '▶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('events')">
        <button class="add-btn" (click)="addEntity('events')">Add Event</button>
        <ul class="data-list">
          <li *ngFor="let item of dataSignals.get('events')!()" class="data-item">
            <div class="item-info">
              {{ item.eventName }} - {{ item.eventDate | date:'fullDate' }}
            </div>
            <div class="item-actions">
        <button class="edit-btn" (click)="editEntity('events', item)">Edit</button>
        <button class="delete-btn" (click)="initiateDelete('event', item.eventID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Payments Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('payments')" [class.expanded]="expandedSections().has('payments')">
        <h2>Payments ({{ countSignals.get('payments')!() }})</h2>
        <span class="toggle-icon">{{ expandedSections().has('payments') ? '▼' : '▶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('payments')">
        <button class="add-btn" (click)="addEntity('payments')">Add Payment</button>
        <ul class="data-list">
          <li *ngFor="let item of dataSignals.get('payments')!()" class="data-item">
            <div class="item-info">
              {{ item.amount }} - {{ item.status }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editEntity('payments', item)">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('payment', item.id)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>


  <!-- Delete Confirmation Modal -->
  <div *ngIf="itemToDelete()" class="modal">
    <div class="modal-content">
      <p>Are you sure you want to delete this {{ itemToDelete()?.type }}?</p>
      <div *ngIf="errorMessage()" class="error-message">{{ errorMessage() }}</div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="cancelDelete()">Cancel</button>
        <button class="confirm-btn" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Feedback Form Modal -->
  <div *ngIf="showFormSignals.get('feedback')!()" class="modal">
    <div class="modal-content">
      <h3>{{ editingSignals.get('feedback')!() ? 'Edit' : 'Add' }} Feedback</h3>
      <form [formGroup]="forms.get('feedback')!" (ngSubmit)="saveForm('feedback')">
        <div class="form-group">
          <label for="comments">Comments:</label>
          <textarea id="comments" formControlName="comments"></textarea>
        </div>
        <div class="form-group">
          <label for="rating">Rating:</label>
          <input type="number" id="rating" formControlName="rating" min="1" max="5">
        </div>
        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="hideForm('feedback')">Cancel</button>
          <button type="submit" class="save-btn">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Notification Form Modal -->
  <div *ngIf="showFormSignals.get('notifications')!()" class="modal">
    <div class="modal-content">
      <h3>{{ editingSignals.get('notifications')!() ? 'Edit' : 'Add' }} Notification</h3>
      <form [formGroup]="forms.get('notifications')!" (ngSubmit)="saveForm('notifications')">
        <div class="form-group">
          <label for="message">Message:</label>
          <input type="text" id="message" formControlName="message">
        </div>
        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="hideForm('notifications')">Cancel</button>
          <button type="submit" class="save-btn">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Ticket Form Modal -->
  <div *ngIf="showFormSignals.get('tickets')!()" class="modal">
    <div class="modal-content">
      <h3>{{ editingSignals.get('tickets')!() ? 'Edit' : 'Add' }} Ticket</h3>
      <form [formGroup]="forms.get('tickets')!" (ngSubmit)="saveForm('tickets')">
        <div class="form-group">
          <label for="eventID">Event ID:</label>
          <input type="text" id="eventID" formControlName="eventID">
        </div>
        <div class="form-group">
          <label for="userID">User ID:</label>
          <input type="text" id="userID" formControlName="userID">
        </div>
        <div class="form-group">
          <label for="bookingDate">Booking Date:</label>
          <input type="date" id="bookingDate" formControlName="bookingDate">
        </div>
        <div class="form-group">
          <label for="isCancelled">Cancelled:</label>
          <input type="checkbox" id="isCancelled" formControlName="isCancelled">
        </div>
        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="hideForm('tickets')">Cancel</button>
          <button type="submit" class="save-btn">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Payment Form Modal -->
  <div *ngIf="showFormSignals.get('payments')!()" class="modal">
    <div class="modal-content">
      <h3>{{ editingSignals.get('payments')!() ? 'Edit' : 'Add' }} Payment</h3>
      <form [formGroup]="forms.get('payments')!" (ngSubmit)="saveForm('payments')">
        <div class="form-group">
          <label for="userId">User ID:</label>
          <input type="text" id="userId" formControlName="userId">
        </div>
        <div class="form-group">
          <label for="amount">Amount:</label>
          <input type="number" id="amount" formControlName="amount" step="0.01">
        </div>
        <div class="form-group">
          <label for="method">Method:</label>
          <input type="text" id="method" formControlName="method">
        </div>
        <div class="form-group">
          <label for="status">Status:</label>
          <input type="text" id="status" formControlName="status">
        </div>
        <div class="form-group">
          <label for="transactionId">Transaction ID:</label>
          <input type="text" id="transactionId" formControlName="transactionId">
        </div>
        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="hideForm('payments')">Cancel</button>
          <button type="submit" class="save-btn">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
