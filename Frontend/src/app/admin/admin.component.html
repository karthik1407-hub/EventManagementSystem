<div class="admin-container">
  <h1 *ngIf="isAdmin()">ADMIN DASHBOARD</h1>
  <h1 *ngIf="isOrganizer()">ORGANIZER DASHBOARD</h1>
  
  <!-- Summary Cards Grid -->
  <div class="dashboard-summary" *ngIf="!isLoading()">
    <div class="summary-card" (click)="toggleSection('users')" *ngIf="isAdmin()">
      <span class="summary-icon">ðŸ‘¤</span>
      <div class="summary-info">
        <h3>Users</h3>
        <p class="count">{{ userCount() }}</p>
      </div>
    </div>
    <div class="summary-card" (click)="toggleSection('feedback')">
      <span class="summary-icon">ðŸ’¬</span>
      <div class="summary-info">
        <h3>Feedback</h3>
        <p class="count">{{ feedbackCount() }}</p>
      </div>
    </div>
    <div class="summary-card" (click)="toggleSection('notifications')">
      <span class="summary-icon">ðŸ””</span>
      <div class="summary-info">
        <h3>Notifications</h3>
        <p class="count">{{ notificationCount() }}</p>
      </div>
    </div>
    <div class="summary-card" (click)="toggleSection('tickets')">
      <span class="summary-icon">ðŸŽ«</span>
      <div class="summary-info">
        <h3>Tickets</h3>
        <p class="count">{{ ticketCount() }}</p>
      </div>
    </div>
    <div class="summary-card" (click)="toggleSection('events')">
      <span class="summary-icon">ðŸ“…</span>
      <div class="summary-info">
        <h3>Events</h3>
        <p class="count">{{ eventCount() }}</p>
      </div>
    </div>
  </div>
  <div *ngIf="isLoading()" class="loading">Loading dashboard...</div>
  
  <div class="admin-sections">
    <!-- Users Section (Admin only) -->
    <section class="admin-section" *ngIf="isAdmin()">
      <div class="section-header" (click)="toggleSection('users')" [class.expanded]="expandedSections().has('users')">
        <span class="section-icon">ðŸ‘¤</span>
        <h2>Users</h2>
        <span class="toggle-icon">{{ expandedSections().has('users') ? 'â–¼' : 'â–¶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('users')">
        <ul class="data-list">
          <li *ngFor="let user of users()" class="data-item">
            <div class="item-info">
              {{ user.name }} - {{ user.email }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editUser(user)" *ngIf="isAdmin()">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('user', user.userID.toString())" *ngIf="isAdmin()">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Feedback Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('feedback')" [class.expanded]="expandedSections().has('feedback')">
        <span class="section-icon">ðŸ’¬</span>
        <h2>Feedback</h2>
        <span class="toggle-icon">{{ expandedSections().has('feedback') ? 'â–¼' : 'â–¶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('feedback')">
        <button class="add-btn" (click)="addFeedback()">Add Feedback</button>
        <ul class="data-list" *ngIf="feedback().length > 0">
          <li *ngFor="let item of feedback()" class="data-item">
            <div class="item-info">
              <strong>Event:</strong> {{ item.eventName || 'N/A' }}<br>
              <strong>User:</strong> {{ item.userEmail || 'Unknown User' }}<br>
              <strong>Comments:</strong> {{ item.comments || 'No comments provided' }}<br>
              <strong>Rating:</strong> {{ item.rating || 0 }}/5 â˜…
            </div>
            <div class="item-actions">
              <!-- <button class="edit-btn" (click)="editFeedback(item)">Edit</button> -->
              <button class="delete-btn" (click)="initiateDelete('feedback', item.feedbackID)">Delete</button>
            </div>
          </li>
        </ul>
        <p *ngIf="feedback().length === 0" class="empty-state">No feedbacks provided</p>
      </div>
    </section>

    <!-- Notifications Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('notifications')" [class.expanded]="expandedSections().has('notifications')">
        <span class="section-icon">ðŸ””</span>
        <h2>Notifications</h2>
        <span class="toggle-icon">{{ expandedSections().has('notifications') ? 'â–¼' : 'â–¶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('notifications')">
        <button class="add-btn" (click)="addNotification()">Add Notification</button>
        <ul class="data-list">
          <li *ngFor="let item of notifications()" class="data-item">
            <div class="item-info">
              <strong>User:</strong> {{ item.user?.email || 'Unknown' }}<br>
              <strong>Message:</strong> {{ item.message }}<br>
              <strong>Sent:</strong> {{ item.sentTimestamp | date:'medium' }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editNotification(item)">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('notification', item.notificationID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Tickets Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('tickets')" [class.expanded]="expandedSections().has('tickets')">
        <span class="section-icon">ðŸŽ«</span>
        <h2>Tickets</h2>
        <span class="toggle-icon">{{ expandedSections().has('tickets') ? 'â–¼' : 'â–¶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('tickets')">
        <button class="add-btn" (click)="addTicket()">Add Ticket</button>
        <ul class="data-list">
          <li *ngFor="let item of tickets()" class="data-item">
            <div class="item-info">
              <strong>Event:</strong> {{ item.event?.eventName || 'N/A' }}<br>
              <strong>User:</strong> {{ item.user?.email || 'Unknown' }}<br>
              <strong>Status:</strong> {{ item.isCancelled ? 'Cancelled' : 'Active' }}<br>
              <strong>Booked:</strong> {{ item.bookingDate | date:'mediumDate' }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editTicket(item)">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('ticket', item.ticketID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <!-- Events Section -->
    <section class="admin-section">
      <div class="section-header" (click)="toggleSection('events')" [class.expanded]="expandedSections().has('events')">
        <span class="section-icon">ðŸ“…</span>
        <h2>Events</h2>
        <span class="toggle-icon">{{ expandedSections().has('events') ? 'â–¼' : 'â–¶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('events')">
        <button class="add-btn" (click)="addEvent()">Add Event</button>
        <ul class="data-list">
          <li *ngFor="let item of events()" class="data-item">
            <div class="item-info">
              <strong>Name:</strong> {{ item.eventName }}<br>
              <strong>Date:</strong> {{ item.eventDate | date:'fullDate' }}<br>
              <!-- <strong>Location:</strong> {{ item.location || 'N/A' }}<br>
              <strong>Description:</strong> {{ item.description || 'N/A' }} -->
            </div>
            <div class="item-actions">
        <button class="edit-btn" (click)="editEvent(item)">Edit</button>
        <button class="delete-btn" (click)="initiateDelete('event', item.eventID)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>
    
   
    <!-- <section class="admin-section">
      <div class="section-header" (click)="toggleSection('payments')" [class.expanded]="expandedSections().has('payments')">
        <h2>Payment</h2>
        <span class="toggle-icon">{{ expandedSections().has('payments') ? 'â–¼' : 'â–¶' }}</span>
      </div>
      <div class="section-content" *ngIf="expandedSections().has('payments')">
        <button class="add-btn" (click)="addPayment()">Add Payment</button>
        <ul class="data-list">
          <li *ngFor="let item of payments()" class="data-item">
            <div class="item-info">
              {{ item.amount | currency }} - {{ item.createdDate | date:'medium' }} - {{ item.status }}
            </div>
            <div class="item-actions">
              <button class="edit-btn" (click)="editPayment(item)">Edit</button>
              <button class="delete-btn" (click)="initiateDelete('payment', item.id)">Delete</button>
            </div>
          </li>
        </ul>
      </div>
    </section>
  </div> -->

  <!-- Delete Confirmation Modal -->
  <div *ngIf="itemToDelete()" class="modal">
    <div class="modal-content">
      <p>Are you sure you want to delete this {{ itemToDelete()?.type }}?</p>
      <div *ngIf="errorMessage()" class="error-message">{{ errorMessage() }}</div>
      <div class="modal-actions">
        <button class="cancel-btn" (click)="cancelDelete()">Cancel</button>
        <button class="confirm-btn" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>
