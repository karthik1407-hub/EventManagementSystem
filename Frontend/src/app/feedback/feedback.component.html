<div class="container my-4">
  <!-- Submit/Edit Feedback Section -->
  <!-- /*<div *ngIf="isUser || isOrganizer || isAdmin" class="feedback-section mb-4">
    <h3 class="card-title mb-3">{{ editingFeedback ? 'Edit Feedback' : 'Submit Feedback' }}</h3>

    Error Message Display
    <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
      {{ errorMessage }}
    </div>

    <form [formGroup]="feedbackForm" (ngSubmit)="editingFeedback ? update() : submit()" class="feedback-form">
      <div class="mb-3">
        <label for="eventID" class="form-label">Event</label>
        <select
          formControlName="eventID"
          class="form-select"
          id="eventID"
          [class.is-invalid]="feedbackForm.get('eventID')?.invalid && feedbackForm.get('eventID')?.touched"
        >
          <option value="" disabled>Select Event</option>
          <option *ngFor="let event of events" [value]="event.eventID">{{ event.eventName }}</option>
        </select>
        <div class="invalid-feedback" *ngIf="feedbackForm.get('eventID')?.invalid && feedbackForm.get('eventID')?.touched">
          Event is required.
        </div>
      </div>

      <div class="mb-3">
        <label for="userID" class="form-label">User ID</label>
        <ng-container *ngIf="isAdmin || isOrganizer; else readonlyUserId">
          <select
            formControlName="userID"
            class="form-select"
            id="userID"
            [class.is-invalid]="feedbackForm.get('userID')?.invalid && feedbackForm.get('userID')?.touched"
          >
            <option value="" disabled>Select User</option>
            <option *ngFor="let user of users" [value]="user.userID">{{ user.email }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="feedbackForm.get('userID')?.invalid && feedbackForm.get('userID')?.touched">
            User ID is required.
          </div>
        </ng-container>
        <ng-template #readonlyUserId>
          <input
            formControlName="userID"
            class="form-control"
            id="userID"
            placeholder="User ID (auto-populated)"
            readonly
            [class.is-valid]="feedbackForm.get('userID')?.valid"
          />
        </ng-template>
      </div>

      <div class="mb-3">
        <label for="rating" class="form-label">Rating (1-5)</label>
        <input
          formControlName="rating"
          type="number"
          class="form-control"
          id="rating"
          min="1"
          max="5"
          placeholder="Enter rating (1-5)"
          [class.is-invalid]="feedbackForm.get('rating')?.invalid && feedbackForm.get('rating')?.touched"
        />
        <div class="invalid-feedback" *ngIf="feedbackForm.get('rating')?.invalid && feedbackForm.get('rating')?.touched">
          Rating is required and must be between 1 and 5.
        </div>
      </div>

      <div class="mb-3">
        <label for="comments" class="form-label">Comments</label>
        <textarea
          formControlName="comments"
          class="form-control"
          id="comments"
          rows="3"
          placeholder="Enter your comments"
          [class.is-invalid]="feedbackForm.get('comments')?.invalid && feedbackForm.get('comments')?.touched"
        ></textarea>
        <div class="invalid-feedback" *ngIf="feedbackForm.get('comments')?.invalid && feedbackForm.get('comments')?.touched">
          Comments are required.
        </div>
      </div>

      <div class="d-flex justify-content-center">
        <button
          type="submit"
          class="btn btn-primary me-2"
          [disabled]="feedbackForm.invalid"
        >
          {{ editingFeedback ? 'Update Feedback' : 'Submit Feedback' }}
        </button>
        <button *ngIf="editingFeedback" type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
  </div> -->

  <!-- All Feedbacks Section -->
  <div class="feedback-section">
    <h4 class="card-title mb-3">All Feedbacks</h4>
    <ul class="list-group">
      <li *ngFor="let fb of feedbacks" class="feedback-card" (click)="openFeedbackPopup(fb)" style="cursor:pointer;">
        <h5 class="mb-1">{{ getEventName(fb.eventID) }}</h5>
        <p class="mb-1"><strong>{{ fb.rating }}/5</strong></p>
      </li>
    </ul>
  </div>

  <!-- Feedback Detail Pop-up -->
  <div *ngIf="showFeedbackPopup && selectedFeedback" class="feedback-popup-overlay" (click)="closeFeedbackPopup()">
    <div class="feedback-popup" (click)="$event.stopPropagation()">
      <h4>{{ getEventName(selectedFeedback.eventID) }}</h4>
      <p><strong>Rating:</strong> {{ selectedFeedback.rating }}/5</p>
      <p><strong>Comments:</strong> {{ selectedFeedback.comments }}</p>
      <p><strong>User:</strong> {{ getUserName(selectedFeedback.userID) }}</p>
      <p><strong>Submitted:</strong> {{ selectedFeedback.submittedTimestamp | date:'medium' }}</p>
      <div *ngIf="selectedFeedback.reply" class="reply-section mb-3 p-2 bg-light border rounded">
        <strong>Organizer Reply:</strong>
        <p>{{ selectedFeedback.reply }}</p>
      </div>
      <div class="mb-3">
        <button class="btn btn-secondary me-2" (click)="editingReply = true; replyText = ''">Reply</button>
      </div>
      <div *ngIf="isOrganizer && editingReply" class="mb-3">
        <label for="replyInput" class="form-label">Add/Edit Reply</label>
        <textarea id="replyInput" class="form-control" [(ngModel)]="replyText" rows="3"></textarea>
        <button class="btn btn-primary mt-2 me-2" (click)="submitReply()">Submit Reply</button>
        <button class="btn btn-secondary mt-2" (click)="cancelReply()">Cancel</button>
      </div>
      <button class="btn btn-danger" (click)="delete(selectedFeedback.feedbackID); closeFeedbackPopup()">Delete Feedback</button>
      <button class="btn btn-secondary ms-2" (click)="closeFeedbackPopup()">Close</button>
    </div>
  </div>
</div>
